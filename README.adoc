:linkattrs:
:project-owner:   redis-field-engineering
:project-name:    redis-smart-cache-cli
:project-group:   com.redis
:project-version: 0.0.2
:project-url:     https://github.com/{project-owner}/{project-name}
:product-name:    Redis Smart Cache CLI
:property-prefix: smartcache
:grafana-dir:     demo/redis-smart-cache-demo/grafana
:imagesdir:       .github/images
:toc:
:toc-placement!:

++++
<p align="center">
  <img alt="Redis Smart Cache" src="https://github.com/redis-field-engineering/redis-smart-cache/raw/master/src/media/Redis Smart Cache Github Banner Light.jpg">

  <p align="center">
    Redis Smart Cache is a JDBC query cache for <a href='https://redis.io/docs/stack/'>Redis Stack</a>, <a href='https://redis.com/redis-enterprise-cloud/overview/'>Redis Cloud</a>, and <a href='https://redis.com/redis-enterprise-software/overview/'>Redis Enterprise</a>.
  </p>
</p>
++++

'''

== Redis Smart Cache CLI

The Redis Smart Cache CLI is a tool for interacting with https://github.com/redis-field-engineering/redis-smart-cache[Redis Smart Cache]

It was created to provide insight into the observations that smart cache is making, as well as to provide you control over
what Smart Cache will cache. The CLI provides a 

=== Installing

Look at the https://github.com/redis-field-engineering/redis-smart-cache-cli/releases[Releases in GitHub], select the latest release and download the relevant binaries for your operating system.

=== Usage

There are two modes of use for the CLI

1. Interactive - navigate the CLIs menus to observe the queries and tables being profiled by smart-cache, and use the interactive menu to apply updates to the rules used to guide Smart Cache's caching decisions
2. Scripted - one off commands to perform a discrete task in the CLI

==== Common Flags

[cols="1,1,1,1,1"]
|===
|Flag Name|Shortcut|Type|Description|Default

| --application
| -s
| string
| The application namespace to use defaults to 'smartcache'
|smartcache

| --help
|
|
| help for smart-cache-cli
|

| --host
| -n
| string
| Host to connect to Redis on
| localhost

| --password
| -a
| string
| The password for Redis

| --port
| -p
| string
| Port to connect to Redis on
| 6379

| --user
| -u
| string
| User to authenticate to Redis with
| default
|===

=== Interactive

To run Redis Smart Cache CLI in interactive mode, simply run the cli `smart-cache-cli` with the whichever common flags are needed to connect to your Redis Instance. This will bring up a dialog with the following options:

. List Queries
. Rule List
. Create Rule
. Table List

==== List Queries
The List Queries table shows you the Queries that SmartCache is currently tracking:

image:query-list-table.png[Query List Table]

this dialog lets you pick which queries you want to create rules for, simply hit space or enter to create a pending rule. This will pop up a rule dialog which will show you expanded details of the query, and allow you to enter a new TTL for the query.

image:query-rule-dialog.png[Query Rule Dialog]

==== List Rules

The List rule dialog will show you the rules currently in force for Smart Cache. You can batch the creation, editing, or deletion of rules.

image:rule-list.png[Rule List]

==== Rule Creation

The Rule creation dialog allows you to create whatever rule you want and move it to the top of the front of the rule priority list.

image:rule-creation.png[Rule Creation Dialog]

==== Table List

The Table list provides you a table level view of the profiling done by Smart Cache. It shows you your tables, their access frequency, the mean query time for all queries executed against them, and the current TTL of any rule that's set in Smart Cache to automatically cache queries against that table. 

image:table-list.png[Table List]

=== Non-Interactive Commands

There are also a couple of non-interactive commands to take note of, specifically there is a way to list queries without using the interactive view, additioanlly you can create a rule without the interactive interface.

==== List Queries

The List queries command lists the queries that are being tracked by Smart Cache, simply run `smart-cache-cli listqueries` and it will list your queries for you

image:list-queries.png[List Queries]

===== List Queries flags

[cols="1,1,1,1,1"]
|===
|Flag Name|Shortcut|Type|Description|Default

|--sortDirection
|-d
|string
|The direction to sort by - valid options are DESC and ASC
|DESC

|--sortby
|-b
|string
|The column to sort by - valid options are 'queryTime', 'accessFrequency', 'tables', and 'id'
|queryTime

|===

==== Rule Creation

The `makerule` command allows you to create rules on the fly. This command is slightly interactive in that if you do not include the `y` flag, it will prompt you
to assent to the rule's creation before pushing it to Redis.

===== Rule Creation Flags

[cols="1,1,1,1,1"]
|===
|Flag Name|Shortcut|Type|Description|required

|--ttl
|-t
|string
|The time to live as a duration (e.g. 5m, 300s, 2d) to enforce as the ttl for the rule.
|yes

|--confirm
|-y
|
| Provide this flag if you don't want the interactive dialog to confirm you want to commit the rule
|no

|--queryIds
|-q
|string
|Comma-delimited unordered set of the ids of the Queries that the rule will apply to.
|no

|--regex
|-r
|string
|The regex to use to match this rule. If the regex matches, the rule wil apply
|no

|--tablesAll
|-l
|string
|Comma-delimited unordered set of tables. Matches if all of the tables in the set appear in the query.
|no

|--tablesAny
|-x
|string
|Comma-delimited unordered set of tables. Matches if any of these tables appear in the query.
|no

|--tablesExact
|-e
|string
|Comma-delimited unordered set of tables. Matches if all of the tables (and no others) appear in the query.
|no

|===